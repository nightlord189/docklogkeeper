<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DockLogKeeper</title>

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: Arial, sans-serif;
            height: 100vh;
            margin: 0;
        }

        .left-menu {
            padding-top: 10px;
            padding-left: 20px;
            height: 100vh;
            background-color: #f4f4f4;
        }

        .left-menu a {
            display: block;
            margin: 10px 0;
            text-decoration: none;
        }

        .log-window {
            height: calc(100vh - 110px);
            border: 1px solid #ddd;
            overflow-y: scroll;
            padding: 10px;
        }

        .bulb {
            border-radius: 50%;      /* Make it round */
            width: 10px;             /* Set width */
            height: 10px;            /* Set height */
            display: inline-block;   /* Inline with text */
            margin-right: 5px;       /* Space before the container name */
        }

        .bulb.alive {
            background-color: green;
        }

        .bulb.dead {
            background-color: red;
        }

        .container {
            padding-left: 5px;
        }

        .container.selected {
            background-color: #e0e0e0;   /* Light grey background */
            border-radius: 4px;          /* Rounded corners */
        }
    </style>
</head>

<body>

<div class="container-fluid h-100">
    <div class="row h-100">

        <!-- Left vertical menu -->
        <div class="col-2 left-menu">
            <h3><a href="/" class="text-primary">DockLogKeeper</a></h3>
            <a id="logoutLink" href="#" class="text-secondary">Logout</a>
            <h5 class="mt-4">Containers:</h5>
            <div id="containersRoot" >
                <a href="#" class="text-dark container selected"><span class="bulb dead"></span>Container 1</a>
                <a href="#" class="text-dark container"><span class="bulb alive"></span>Container 2</a>
                <a href="#" class="text-dark container"><span class="bulb alive"></span>Container 3</a>
                <!-- ... add as many container links as you need -->
            </div>
        </div>

        <!-- Right part -->
        <div class="col-10">
            <!-- Upper block with search bar -->
            <div class="input-group mb-3 mt-3">
                <input type="text" class="form-control" placeholder="Search logs..." aria-label="Search logs">
                <div class="input-group-append">
                    <button id="findButton" class="btn btn-primary" type="button">Find</button>
                </div>
            </div>

            <!-- Scrollable window for logs -->
            <div id="logsRoot" class="log-window">
                <!-- Sample log entries, can be replaced with dynamic content -->
                Log entry 1<br> Log entry 2<br> Log entry 3<br>
                <!-- ... -->
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS, Popper.js, and jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="/js/main.js"></script>
<script>
    window.onload = function() {
        if (!isAuthorized()) {
            console.log('user is not authorized');
            window.location.href = '/';
        }
    };

    async function renderContainers(containers) {
        const contRoot = document.getElementById('containersRoot');

        // 1. Remove all children of containersRoot
        while (contRoot.firstChild) {
            contRoot.removeChild(contRoot.firstChild);
        }

        // 2. Iterate over each container item and append to containersRoot
        containers.forEach(item => {
            const containerLink = document.createElement('a');
            containerLink.href = "#"; // You can modify the href as required
            containerLink.className = 'text-dark container';

            // Create the status bulb and assign the appropriate class
            const statusBulb = document.createElement('span');
            statusBulb.className = 'bulb ' + (item.isAlive ? 'alive' : 'dead');

            // Append the status bulb and container name
            containerLink.appendChild(statusBulb);
            containerLink.appendChild(document.createTextNode(item.shortName));

            // Click event to update the selected container
            containerLink.addEventListener('click', function() {
                // Remove the selected-container class from any other container
                const selected = document.querySelector('a.container.selected');
                if (selected) {
                    selected.classList.remove('selected');
                }

                // Add the selected-container class to the clicked container
                containerLink.classList.add('selected' +
                    '');
            });

            contRoot.appendChild(containerLink);
        });
    }


    async function updateContainers () {
        try {
            const resp = await fetch('/api/container', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            });
            const respJson = await resp.json();

            if (resp.status <= 299) {
                console.log('success get containers');
                await renderContainers(respJson.containers);
            } else {
                const errorMessage = respJson.message || 'Something went wrong';
                console.log(errorMessage);
            }
        } catch (err) {
            console.log(err);
        }
    }

    document.addEventListener('DOMContentLoaded', async function() {
        const logoutLink = document.getElementById('logoutLink');

        logoutLink.addEventListener('click', function () {
            logout();
        });

        await updateContainers();
    });
</script>

</body>

</html>
